"use strict";(self.webpackChunkmirador_mosaic=self.webpackChunkmirador_mosaic||[]).push([[765],{"./src/components/DropTarget.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var prop_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_2__),react_dnd__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-dnd/dist/hooks/useDrop/useDrop.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/jsx-runtime.js");function DropTarget({dir="left",size="30%",style={},...props}){const[{dropAreaStyles},drop]=(0,react_dnd__WEBPACK_IMPORTED_MODULE_1__.L)((()=>({accept:"mirador.window",drop:()=>({dir}),collect:monitor=>({dropAreaStyles:monitor.isOver()&&monitor.canDrop()?{backgroundColor:"rgba(0,0,0,0.3)",border:"2px solid #000"}:{}})})),[]),position={top:{bottom:`calc(100% - ${size})`},bottom:{top:`calc(100% - ${size})`},left:{right:`calc(100% - ${size})`},right:{left:`calc(100% - ${size})`}};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{...props,ref:drop,style:{position:"absolute",inset:0,...position[dir]||{},...style,...dropAreaStyles}})}function DropTargetContainer({isOver=!1,padding=0,size="30%",style,targetStyle,...props}){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{style:{position:"absolute",inset:padding,...style},...props,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(DropTarget,{dir:"top",size,style:{...targetStyle,zIndex:isOver?1:void 0}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(DropTarget,{dir:"bottom",size,style:{...targetStyle,zIndex:isOver?1:void 0}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(DropTarget,{dir:"left",size,style:{...targetStyle,zIndex:isOver?1:void 0}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(DropTarget,{dir:"right",size,style:{...targetStyle,zIndex:isOver?1:void 0}})]})}DropTarget.displayName="DropTarget",DropTarget.propTypes={dir:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,size:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,style:prop_types__WEBPACK_IMPORTED_MODULE_2___default().object},DropTargetContainer.displayName="DropTargetContainer",DropTargetContainer.propTypes={isOver:prop_types__WEBPACK_IMPORTED_MODULE_2___default().bool,padding:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number,size:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,style:prop_types__WEBPACK_IMPORTED_MODULE_2___default().object,targetStyle:prop_types__WEBPACK_IMPORTED_MODULE_2___default().object},DropTargetContainer.__docgenInfo={description:"Container for the various drop targets (top, bottom, left, right)\nwithin a window.",methods:[],displayName:"DropTargetContainer",props:{isOver:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},padding:{defaultValue:{value:"0",computed:!1},description:"",type:{name:"number"},required:!1},size:{defaultValue:{value:"'30%'",computed:!1},description:"",type:{name:"string"},required:!1},style:{description:"",type:{name:"object"},required:!1},targetStyle:{description:"",type:{name:"object"},required:!1}}};const __WEBPACK_DEFAULT_EXPORT__=DropTargetContainer},"./src/components/Tile.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>components_Tile});var react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),useDrag=__webpack_require__("./node_modules/react-dnd/dist/hooks/useDrag/useDrag.js"),useDrop=__webpack_require__("./node_modules/react-dnd/dist/hooks/useDrop/useDrop.js"),DropTarget=__webpack_require__("./src/components/DropTarget.js"),GridProvider=__webpack_require__("./src/context/GridProvider.js"),utils_grid=__webpack_require__("./src/utils/grid.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function DragHandle({box,dir,style}){const grid=(0,react.useContext)(GridProvider._p),dispatch=(0,react.useContext)(GridProvider.AL),[hasFocus,setFocus]=(0,react.useState)(!1),[{},drag,preview]=(0,useDrag.c)((()=>({type:"mirador.handle",item:{box,dir}})),[]),bounds=(0,utils_grid.zX)(grid,box),{rows,columns}=grid;if("top"===dir&&0===bounds.top)return null;if("bottom"===dir&&bounds.bottom===rows.length)return null;if("left"===dir&&0===bounds.left)return null;if("right"===dir&&bounds.right===columns.length)return null;const handleStyles={backgroundColor:"rgba(0,0,0,0.5)",position:"absolute",opacity:0,...hasFocus&&{backgroundColor:"rgba(0,0,0,0.8)",opacity:.5,transition:"opacity 0.2s ease-in-out"}};return(0,jsx_runtime.jsx)("div",{ref:preview,role:"separator",onKeyDown:({shiftKey,key})=>{const size=shiftKey?.001:.05;switch(key){case"Down":case"ArrowDown":"bottom"===dir?dispatch({type:"resize",final:!0,id:box,dir,value:{bottom:size}}):"top"===dir&&dispatch({type:"resize",final:!0,id:box,dir,value:{top:size}});break;case"Up":case"ArrowUp":"bottom"===dir?dispatch({type:"resize",final:!0,id:box,dir,value:{bottom:-1*size}}):"top"===dir&&dispatch({type:"resize",final:!0,id:box,dir,value:{top:-1*size}});break;case"Left":case"ArrowLeft":"left"===dir?dispatch({type:"resize",final:!0,id:box,dir,value:{left:-1*size}}):"right"===dir&&dispatch({type:"resize",final:!0,id:box,dir,value:{right:-1*size}});break;case"Right":case"ArrowRight":"left"===dir?dispatch({type:"resize",final:!0,id:box,dir,value:{left:size}}):"right"===dir&&dispatch({type:"resize",final:!0,id:box,dir,value:{right:size}});break;case"Home":dispatch({type:"resize",final:!0,id:box,dir,value:{[dir]:-1}});break;case"End":dispatch({type:"resize",final:!0,id:box,dir,value:{[dir]:1}})}},onFocus:()=>setFocus(!0),onBlur:()=>setFocus(!1),onDragStart:()=>setFocus(!1),onDragEnd:()=>setFocus(!0),tabIndex:0,style:{...handleStyles,...style},children:(0,jsx_runtime.jsx)("div",{ref:drag,style:{position:"absolute",inset:0,opacity:0}})})}function DragHandles({size=5,style={},...props}){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(DragHandle,{...props,dir:"left",style:{...style,left:-1*Math.floor(size/2),width:size,top:0,bottom:0,cursor:"ew-resize"}}),(0,jsx_runtime.jsx)(DragHandle,{...props,dir:"top",style:{...style,top:-1*Math.floor(size/2),height:size,left:0,right:0,cursor:"ns-resize"}}),(0,jsx_runtime.jsx)(DragHandle,{...props,dir:"right",style:{...style,right:-1*Math.floor(size/2),width:size,top:0,bottom:0,cursor:"ew-resize"}}),(0,jsx_runtime.jsx)(DragHandle,{...props,dir:"bottom",style:{...style,bottom:-1*Math.floor(size/2),height:size,left:0,right:0,cursor:"ns-resize"}})]})}function Tile({children,id,onDropFailed=()=>{},gridArea=id,targetStyle={}}){const[{isDragging,opacity},dragHandle,preview]=(0,useDrag.c)((()=>({type:"mirador.window",item:{id},collect:monitor=>({isDragging:monitor.isDragging(),opacity:monitor.isDragging()?.4:1}),end:(item,monitor)=>{monitor.didDrop()||onDropFailed({id})}}))),[{isOver},drop]=(0,useDrop.L)((()=>({accept:"mirador.window",drop:(item,monitor)=>({...monitor.getDropResult(),box:id}),hover:(item,monitor)=>({...monitor.getDropResult(),box:id}),collect:monitor=>({isOver:monitor.getItem()?.id!==id&&monitor.isOver()})})),[]),tileStyle={gridArea,display:isDragging?"none":"block",position:isDragging?"absolute":"relative"},windowStyle={position:"relative",opacity,width:"100%",height:"100%"},child=(0,react.useMemo)((()=>(0,react.cloneElement)(children,{dragHandle})),[children,dragHandle]);return(0,jsx_runtime.jsxs)("div",{ref:drop,style:tileStyle,children:[(0,jsx_runtime.jsx)(DropTarget.Z,{isOver,padding:4,targetStyle}),(0,jsx_runtime.jsx)("div",{ref:preview,style:windowStyle,children:child}),(0,jsx_runtime.jsx)(DragHandles,{box:id})]})}DragHandle.displayName="DragHandle",DragHandle.propTypes={box:prop_types_default().string,dir:prop_types_default().string,style:prop_types_default().object},DragHandles.propTypes={box:prop_types_default().string,size:prop_types_default().number,style:prop_types_default().object},DragHandles.__docgenInfo={description:"",methods:[],displayName:"DragHandles",props:{size:{defaultValue:{value:"5",computed:!1},description:"",type:{name:"number"},required:!1},style:{defaultValue:{value:"{}",computed:!1},description:"",type:{name:"object"},required:!1},box:{description:"",type:{name:"string"},required:!1}}},Tile.displayName="Tile",Tile.propTypes={children:prop_types_default().node,id:prop_types_default().string,onDropFailed:prop_types_default().func,gridArea:prop_types_default().string,targetStyle:prop_types_default().object},Tile.__docgenInfo={description:"",methods:[],displayName:"Tile",props:{onDropFailed:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"func"},required:!1},gridArea:{defaultValue:{value:"id",computed:!0},description:"",type:{name:"string"},required:!1},targetStyle:{defaultValue:{value:"{}",computed:!1},description:"",type:{name:"object"},required:!1},children:{description:"",type:{name:"node"},required:!1},id:{description:"",type:{name:"string"},required:!1}}};const components_Tile=Tile},"./src/context/GridProvider.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AL:()=>GridDispatchContext,_p:()=>GridContext,kc:()=>GridProvider});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_3__),_utils_grid__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utils/grid.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const GridContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(void 0),GridDispatchContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(void 0),gridReducer=(state,action)=>{switch(action.type){case"update_windows":{const layoutAreaNames=_utils_grid__WEBPACK_IMPORTED_MODULE_2__.Ke(state),added=action.childIds.filter((id=>!layoutAreaNames.has(id))),removed=Array.from(layoutAreaNames).filter((id=>!action.childIds.includes(id)));if(0===added.length&&0===removed.length)return state;const{columns}=state,newSize=Math.max(1,columns.reduce(((a,b)=>a+b),0)/Math.max(columns.length,1)),newState=added.reduce(((acc,id)=>_utils_grid__WEBPACK_IMPORTED_MODULE_2__.Wf(acc,columns.length,newSize,{fill:id})),state);return _utils_grid__WEBPACK_IMPORTED_MODULE_2__.UO(_utils_grid__WEBPACK_IMPORTED_MODULE_2__.hX(newState,(v=>removed.includes(v))))}case"remove":return _utils_grid__WEBPACK_IMPORTED_MODULE_2__.UO(_utils_grid__WEBPACK_IMPORTED_MODULE_2__.RS(state,action.id));case"add":{const{columns}=state,newSize=Math.min(1,columns.reduce(((a,b)=>a+b),0)/columns.length);return _utils_grid__WEBPACK_IMPORTED_MODULE_2__.Wf(state,columns.length,newSize,{fill:action.id})}case"set":return _utils_grid__WEBPACK_IMPORTED_MODULE_2__.UO(action.layout);case"start_drag":return{...state,temporaryLayout:_utils_grid__WEBPACK_IMPORTED_MODULE_2__.UO(_utils_grid__WEBPACK_IMPORTED_MODULE_2__.RS(state,action.id))};case"end_drag":return{...state,temporaryLayout:null};case"drop":{const{id,box="root",dir}=action;let result;if("root"===box){const{rows,columns}=state,bounds=_utils_grid__WEBPACK_IMPORTED_MODULE_2__.zX(state,id),newSize="right"===dir||"left"===dir?bounds.right-bounds.left:bounds.bottom-bounds.top,{areas:newAreas}=_utils_grid__WEBPACK_IMPORTED_MODULE_2__.RS(state,id);if("top"===dir||"bottom"===dir){const fill=columns.map((()=>id));result=_utils_grid__WEBPACK_IMPORTED_MODULE_2__.iz({rows,columns,areas:newAreas},"top"===dir?0:rows.length,newSize,{fill,resize:!0})}else"left"!==dir&&"right"!==dir||(result=_utils_grid__WEBPACK_IMPORTED_MODULE_2__.Wf({rows,columns,areas:newAreas},"left"===dir?0:columns.length,newSize,{fill:id,resize:!0}))}else{const split="left"===dir||"right"===dir?_utils_grid__WEBPACK_IMPORTED_MODULE_2__.Fy:_utils_grid__WEBPACK_IMPORTED_MODULE_2__.BG,{left,right,top,bottom}=_utils_grid__WEBPACK_IMPORTED_MODULE_2__.zX(state,box),first="left"===dir||"right"===dir?left:top,last="left"===dir||"right"===dir?right:bottom,{rows,columns,areas}=(last-first)%2==1?split(state,Math.floor(first+(last-first)/2)):state,midpoint=Math.floor((first+last+((last-first)%2==1?1:0))/2),newAreas=areas.map(((data,row)=>data.map(((v,col)=>{const bound="left"===dir||"right"===dir?col:row;return v===id?".":"left"===dir||"top"===dir?v===box&&bound<midpoint?id:v:("right"===dir||"bottom"===dir)&&v===box&&bound>=midpoint?id:v}))));result={...state,rows,columns,areas:newAreas,dir}}return result?{..._utils_grid__WEBPACK_IMPORTED_MODULE_2__.UO(result),temporaryLayout:null}:state}case"resize":{const{id,value,dir,final}=action,{rows,columns}=state;if(0===value[dir])return state;const widthFrs=columns.reduce(((a,b)=>a+b),0),heightFrs=rows.reduce(((a,b)=>a+b),0),size="right"===dir||"left"===dir?value[dir]*widthFrs:value[dir]*heightFrs,result=_utils_grid__WEBPACK_IMPORTED_MODULE_2__.$e(state,id,dir,size);return final&&result?{..._utils_grid__WEBPACK_IMPORTED_MODULE_2__.UO(result),temporaryLayout:null}:{...state,temporaryLayout:result}}default:throw Error(`Unknown action: ${action.type}`)}};function GridProvider({children,childIds,value}){const upstreamContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(GridContext),upstreamDispatch=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(GridDispatchContext),[gridTemplate,dispatch]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useReducer)(gridReducer,value,(l=>_utils_grid__WEBPACK_IMPORTED_MODULE_2__.UO(l||_utils_grid__WEBPACK_IMPORTED_MODULE_2__.BZ(childIds))));return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{(upstreamDispatch||dispatch)({type:"update_windows",childIds})}),[childIds]),upstreamContext?children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(GridContext.Provider,{value:gridTemplate,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(GridDispatchContext.Provider,{value:dispatch,children})})}GridProvider.displayName="GridProvider",GridProvider.propTypes={children:prop_types__WEBPACK_IMPORTED_MODULE_3___default().node.isRequired,childIds:prop_types__WEBPACK_IMPORTED_MODULE_3___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_3___default().string),value:prop_types__WEBPACK_IMPORTED_MODULE_3___default().shape({rows:prop_types__WEBPACK_IMPORTED_MODULE_3___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_3___default().number),columns:prop_types__WEBPACK_IMPORTED_MODULE_3___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_3___default().number),areas:prop_types__WEBPACK_IMPORTED_MODULE_3___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_3___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_3___default().string))})},GridProvider.__docgenInfo={description:"",methods:[],displayName:"GridProvider",props:{children:{description:"",type:{name:"node"},required:!0},childIds:{description:"",type:{name:"arrayOf",value:{name:"string"}},required:!1},value:{description:"",type:{name:"shape",value:{rows:{name:"arrayOf",value:{name:"number"},required:!1},columns:{name:"arrayOf",value:{name:"number"},required:!1},areas:{name:"arrayOf",value:{name:"arrayOf",value:{name:"string"}},required:!1}}},required:!1}}}},"./src/utils/grid.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$e:()=>resizeBox,BG:()=>splitRow,BZ:()=>calculateDefaultLayout,Fy:()=>splitColumn,Ke:()=>getAreaNames,RS:()=>removeBox,UO:()=>cleanupGrid,Wf:()=>insertColumn,hX:()=>filter,iz:()=>insertRow,zX:()=>getBounds});const getAreaNames=({areas})=>{const names=new Set;return areas.forEach((row=>{row.forEach((name=>{"."!==name&&names.add(name)}))})),names},removeEmptyGridRowCols=({rows,columns,areas,...other})=>{const newAreas=areas.filter(((row,i)=>rows[i]>0)).map((r=>r.filter(((v,i)=>columns[i]>0)))),before=Array.from(getAreaNames({areas})),after=getAreaNames({areas:newAreas});return before.every((item=>after.has(item)))?{rows:rows.filter((row=>row>0)),columns:columns.filter((col=>col>0)),areas:newAreas,...other}:{rows,columns,areas,...other}},cleanupRedundantRows=({rows,columns,areas,...other})=>{const rowsToCompact=areas.map(((row,i)=>areas[i-1]&&row.every(((v,j)=>v===areas[i-1][j]))?i:null)).filter((v=>null!==v));return{rows:rows.map(((c,i)=>rowsToCompact.includes(i+1)?c+rows[i+1]:c)).filter(((v,i)=>!rowsToCompact.includes(i))),columns,areas:areas.filter(((row,i)=>!rowsToCompact.includes(i))),...other}},cleanupRedundantColumns=({rows,columns,areas,...other})=>{const columnsToCompact=columns.map(((_c,i)=>{if(0===i)return null;const prevCol=areas.map((row=>row[i-1]));return areas.map((row=>row[i])).every(((v,j)=>v===prevCol[j]))?i:null}));return{rows,columns:columns.map(((c,i)=>columnsToCompact.includes(i+1)?c+columns[i+1]:c)).filter(((v,i)=>!columnsToCompact.includes(i))),areas:areas.map((row=>row.filter(((v,i)=>!columnsToCompact.includes(i))))),...other}},cleanupPlaceholderColumns=({rows,columns,areas,...other})=>{const columnsToRemove=columns.map(((c,i)=>areas.every((row=>"."===row[i]))?i:null)).filter((v=>null!==v)),newColumns=columns.filter(((v,i)=>!columnsToRemove.includes(i))),adj=columns.reduce(((a,b)=>a+b),0)/newColumns.reduce(((a,b)=>a+b),0);return{rows,columns:newColumns.map((c=>c*adj)),areas:areas.map((row=>row.filter(((v,i)=>!columnsToRemove.includes(i))))),...other}},cleanupPlaceholderRows=({rows,columns,areas,...other})=>{const rowsToRemove=rows.map(((c,i)=>areas[i].every((v=>"."===v))?i:null)).filter((v=>null!==v)),newRows=rows.filter(((v,i)=>!rowsToRemove.includes(i))),adj=rows.reduce(((a,b)=>a+b),0)/newRows.reduce(((a,b)=>a+b),0);return{rows:newRows.map((c=>c*adj)),columns,areas:areas.filter(((row,i)=>!rowsToRemove.includes(i))),...other}},calculateSpans=areas=>{const spans=new Map;return areas.forEach(((row,i)=>{row.forEach(((v,j)=>{spans.has(v)||spans.set(v,{id:v,top:Number.MAX_SAFE_INTEGER,left:Number.MAX_SAFE_INTEGER,bottom:-1,right:-1});const obj=spans.get(v);obj.top=Math.min(obj.top,i),obj.left=Math.min(obj.left,j),obj.bottom=Math.max(obj.bottom,i+1),obj.right=Math.max(obj.right,j+1)}))})),spans},iterativeBinPacking=grid=>{const iterations=Math.max(grid.columns.length,grid.rows.length);return Array(iterations).fill(0).reduce((g=>(({rows,columns,areas,dir="left",...other})=>{if(0===areas.reduce(((sum,row)=>sum+row.filter((v=>"."===v)).length)))return{rows,columns,areas};const spans=calculateSpans(areas),horizontal=[areas.map((row=>row.map(((v,j)=>{if("."!==v)return v;const span=spans.get(v),neighbor=spans.get(row[j-1]);return neighbor&&neighbor.top>=span.top&&neighbor.bottom<=span.bottom?row[j-1]:"."})))),areas.map((row=>row.map(((v,j)=>{if("."!==v)return v;const span=spans.get(v),neighbor=spans.get(row[j+1]);return neighbor&&neighbor.top>=span.top&&neighbor.bottom<=span.bottom?row[j+1]:"."}))))],vertical=[areas.map(((row,i)=>row.map(((v,j)=>{if("."!==v||0===i)return v;const span=spans.get(v),neighbor=spans.get(areas[i-1][j]);return neighbor&&neighbor.left>=span.left&&neighbor.right<=span.right?areas[i-1][j]:"."})))),areas.map(((row,i)=>row.map(((v,j)=>{if("."!==v||i===areas.length-1)return v;const span=spans.get(v),neighbor=spans.get(areas[i+1][j]);return neighbor&&neighbor.left>=span.left&&neighbor.right<=span.right?areas[i+1][j]:"."}))))];return{rows,columns,areas:("left"===dir||"right"===dir?[areas,...horizontal,...vertical]:[areas,...vertical,...horizontal]).reduce(((best,next)=>{const bestScore=best.reduce(((sum,row)=>sum+row.filter((v=>"."===v)).length),0);return next.reduce(((sum,row)=>sum+row.filter((v=>"."===v)).length),0)<bestScore?next:best})),...other}})(g)),grid)},rescaleGrid=({rows,columns,...other})=>{const rowMax=Math.max.apply(null,rows),colMax=Math.max.apply(null,columns);if(rowMax>=1&&colMax>=1)return{rows,columns,...other};const rowScale=rowMax<1?1/rowMax:1,colScale=colMax<1?1/colMax:1;return{rows:rows.map((r=>r*rowScale)),columns:columns.map((c=>c*colScale)),...other}},cleanupGrid=grid=>[removeEmptyGridRowCols,cleanupRedundantRows,cleanupRedundantColumns,cleanupPlaceholderColumns,cleanupPlaceholderRows,iterativeBinPacking,rescaleGrid].reduce(((g,step)=>step(g)||grid),grid),insertColumn=({rows,columns,areas,...other},index,size,{fill,resize=!1}={})=>{const colSize=columns.reduce(((a,b)=>a+b),0),adj=resize?1-size/colSize:1;return 0===rows.length&&0===columns.length?{rows:[1],columns:[1],areas:[[fill||"."]]}:{rows,columns:[...columns.slice(0,index).map((i=>i*adj)),size,...columns.slice(index).map((i=>i*adj))],areas:areas.map((row=>[...row.slice(0,index),fill||row[Math.min(index,row.length-1)],...row.slice(index)])),...other}},insertRow=({rows,columns,areas,...other},index,size,{fill,resize=!1}={})=>{const rowSize=rows.reduce(((a,b)=>a+b),0),adj=resize&&size!==rowSize?1-size/rowSize:1;return{rows:[...rows.slice(0,index).map((i=>i*adj)),size,...rows.slice(index).map((i=>i*adj))],columns,areas:[...areas.slice(0,index),fill||areas[Math.min(index,rows.length-1)],...areas.slice(index)],...other}},splitRow=({rows,columns,areas,...other},index)=>({rows:[...rows.slice(0,index),rows[index]/2,rows[index]/2,...rows.slice(index+1)],columns,areas:[...areas.slice(0,index),[...areas[index]],...areas.slice(index)],...other}),splitColumn=({rows,columns,areas,...other},index)=>({rows,columns:[...columns.slice(0,index),columns[index]/2,columns[index]/2,...columns.slice(index+1)],areas:areas.map((row=>[...row.slice(0,index),row[index],row[index],...row.slice(index+1)])),...other}),resizeColumn=({rows,columns,areas,...other},func)=>({rows,columns:columns.map(func),areas,...other}),resizeRow=({rows,columns,areas,...other},func)=>({rows:rows.map(func),columns,areas,...other}),getBounds=({areas},id)=>{const row=areas.find((r=>r.includes(id)))||[];return{right:row.lastIndexOf(id)+1,left:row.indexOf(id),top:areas.findIndex((r=>r.includes(id))),bottom:areas.findLastIndex((r=>r.includes(id)))+1}},calculateDefaultLayout=children=>({rows:[1],columns:Array(children.length).fill(1),areas:[children]}),removeBox=(grid,id)=>({...grid,areas:grid.areas.map((row=>row.map((v=>v===id?".":v))))}),filter=(grid,fn=(()=>{}))=>({...grid,areas:grid.areas.map((row=>row.map((v=>fn(v)?".":v))))}),fillAreas=({areas,...other},fn)=>({...other,areas:areas.map(((row,i)=>row.map(((v,j)=>fn(areas,i,j,v)))))}),resize=(grid,index,dir,size)=>("right"===dir||"left"===dir?resizeColumn:resizeRow)(grid,((v,i)=>i===index?Math.max(0,v-size):i===index-1?Math.max(0,v+size):v)),resizeBox=(grid,id,dir,size)=>{const{areas,rows,columns}=grid,spans=calculateSpans(areas),bounds=getBounds(grid,id);if("right"===dir&&bounds.right===columns.length)return grid;if("left"===dir&&0===bounds.left)return grid;if("top"===dir&&0===bounds.top)return grid;if("bottom"===dir&&bounds.bottom===rows.length)return grid;if("top"===dir){const upperLeft=spans.get(areas[bounds.top-1][bounds.left]),upperRight=spans.get(areas[bounds.top-1][bounds.right-1]);if(upperLeft.left<bounds.left||upperRight.right>bounds.right)return resize(grid,bounds.top,dir,size)}else if("bottom"===dir){const bottomLeft=spans.get(areas[bounds.bottom][bounds.left]),bottomRight=spans.get(areas[bounds.bottom][bounds.right-1]);if(bottomLeft.left<bounds.left||bottomRight.right>bounds.right)return resize(grid,bounds.bottom,dir,size)}else if("left"===dir){const upperLeft=spans.get(areas[bounds.top][bounds.left-1]),bottomLeft=spans.get(areas[bounds.bottom-1][bounds.left-1]);if(upperLeft.top<bounds.top||bottomLeft.bottom>bounds.bottom)return resize(grid,bounds.left,dir,size)}else if("right"===dir){const upperRight=spans.get(areas[bounds.top][bounds.right]),bottomRight=spans.get(areas[bounds.bottom-1][bounds.right]);if(upperRight.top<bounds.top||bottomRight.bottom>bounds.bottom)return resize(grid,bounds.right,dir,size)}if("left"===dir||"right"===dir){const offset=0,columnToSplit=bounds[dir]+(size>0?0:-1);return[[splitColumn,columnToSplit],[resizeColumn,(v,i)=>i===bounds[dir]?Math.max(0,Math.abs(size)-offset):size<0&&i===bounds[dir]-1?Math.max(0,columns[bounds[dir]-1]-(Math.abs(size)-offset)):size>0&&i===bounds[dir]+1?Math.max(0,columns[bounds[dir]]-(Math.abs(size)-offset)):v],[fillAreas,(a,i,j,v)=>i>=bounds.top&&i<bounds.bottom&&j===bounds[dir]?a[i][j+(size>0?-1:1)]:v],[rescaleGrid]].reduce(((g,[fn,...args])=>fn(g,...args)),grid)}if("top"===dir||"bottom"===dir){const offset=0,rowToSplit=bounds[dir]+(size>0?0:-1);return[[splitRow,rowToSplit],[resizeRow,(v,i)=>i===bounds[dir]?Math.max(0,Math.abs(size)-offset):size<0&&i===bounds[dir]-1?Math.max(0,rows[bounds[dir]-1]-(Math.abs(size)-offset)):size>0&&i===bounds[dir]+1?Math.max(0,rows[bounds[dir]]-(Math.abs(size)-offset)):v],[fillAreas,(a,i,j,v)=>j>=bounds.left&&j<bounds.right&&i===bounds[dir]?a[i+(size>0?-1:1)][j]:v],[rescaleGrid]].reduce(((g,[fn,...args])=>fn(g,...args)),grid)}return grid}}}]);